{% extends "base.html" %}

{% block content %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet/dist/leaflet.css"
/>
<a href="/create" class="btn">Create New Record</a>
<a href="/export/csv" class="btn">Export CSV</a>
<a href="/export/json" class="btn">Export JSON</a>
<a href="/export/markdown" class="btn">Export Markdown</a>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Location</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Temp Min</th>
      <th>Temp Max</th>
      <th>Map and Videos</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% if records %}
      {% for rec in records %}
      <tr>
        <td>{{ rec.id }}</td>
        <td>{{ rec.location }}</td>
        <td>{{ rec.latitude }}</td>
        <td>{{ rec.longitude }}</td>
        <td>{{ rec.start_date }}</td>
        <td>{{ rec.end_date }}</td>
        <td>{{ rec.temperature_min or '' }}</td>
        <td>{{ rec.temperature_max or '' }}</td>
        <td>
          <div id="map{{ rec.id }}" style="height: 200px; width: 300px;"></div>
          <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
          <script>
            var map{{ rec.id }} = L.map('map{{ rec.id }}').setView([{{ rec.latitude }}, {{ rec.longitude }}], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 19,
            }).addTo(map{{ rec.id }});
            L.marker([{{ rec.latitude }}, {{ rec.longitude }}]).addTo(map{{ rec.id }});
          </script>
          <h4>Related YouTube Videos:</h4>
          <ul>
            {% for link in rec.youtube_links %}
            <li><a href="{{ link }}" target="_blank">{{ link }}</a></li>
            {% endfor %}
          </ul>
        </td>
        <td>
          <a href="/edit/{{ rec.id }}">Edit</a>
          <form method="post" action="/delete/{{ rec.id }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this record?');">
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="10">No records found</td></tr>
    {% endif %}
  </tbody>
</table>

<!-- Leaflet CSS and JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

{% endblock %}
